<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="mindthegap">
<title>Epidemic Control Plots • mindthegap</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Epidemic Control Plots">
<meta property="og:description" content="mindthegap">
<meta property="og:image" content="https://usaid-oha-si.github.io/mindthegap/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">mindthegap</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/accessing-clean-unaids.html">Accesing Clean UNAIDS Data</a>
    <a class="dropdown-item" href="../articles/epi_control_plots.html">Epidemic Control Plots</a>
    <a class="dropdown-item" href="../articles/relative-plhiv-base.html">90-90-90 Target Progress: Relative Base vs. PLHIV Base</a>
    <a class="dropdown-item" href="../articles/unaids-data-dictionary.html">Data Dictionary &amp; Use Cases</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/USAID-OHA-SI/mindthegap/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="epi_control_plots_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Epidemic Control Plots</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/USAID-OHA-SI/mindthegap/blob/HEAD/vignettes/epi_control_plots.Rmd" class="external-link"><code>vignettes/epi_control_plots.Rmd</code></a></small>
      <div class="d-none name"><code>epi_control_plots.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>PEPFAR defines HIV epidemic control as the “point at which the total number of new HIV infections falls below the total number of deaths from all causes among HIV-infected individuals, with both declining.” The integer indicators in the HIV Estimates data can be used to analyze and plot these trends.</p>
<p>To assess progress towards this definition of epidemic control, we can use the <code>"HIV Estimates - Integer"</code> tab of the UNAIDS data. This vignette will walk through how to use the <code>epi_plot</code> function in the MindTheGap package to generate plots.</p>
<div class="section level3">
<h3 id="epidemic-control-plotting-function">Epidemic Control Plotting Function<a class="anchor" aria-label="anchor" href="#epidemic-control-plotting-function"></a>
</h3>
<p>First, let’s take a look at the <code>epi_plot</code> function in action: to use this function, first load the <code>mindthegap</code> package and specify your PEPFAR country of interest in the <code>sel_cntry</code> parameter of the <code>epi_plot</code> function.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/USAID-OHA-SI/mindthegap" class="external-link">mindthegap</a></span><span class="op">)</span>

<span class="fu"><a href="../reference/epi_plot.html">epi_plot</a></span><span class="op">(</span>sel_cntry <span class="op">=</span> <span class="st">"Kenya"</span><span class="op">)</span></code></pre></div>
<p>In addition to looking at epidemic control at the country level, we can also see trends across all of PEPFAR by using <code>sel_cntry == "ALL PEPFAR"</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/USAID-OHA-SI/mindthegap" class="external-link">mindthegap</a></span><span class="op">)</span>

<span class="fu"><a href="../reference/epi_plot.html">epi_plot</a></span><span class="op">(</span>sel_cntry <span class="op">=</span> <span class="st">"ALL PEPFAR"</span><span class="op">)</span></code></pre></div>
<p>This function makes it really easy to generate plots on your own for countries of interest. Let’s peek under the hood and see how the function works to munge the data and create the plots.</p>
</div>
<div class="section level3">
<h3 id="reshaping-epidemic-control-data">Reshaping epidemic control data<a class="anchor" aria-label="anchor" href="#reshaping-epidemic-control-data"></a>
</h3>
<p>First, let’s load all the other libraries that we need to generate these plots and load the <code>HIV Estimates - Integer</code> data.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">glitr</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/wch/extrafont" class="external-link">extrafont</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://scales.r-lib.org" class="external-link">scales</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/juliasilge/tidytext" class="external-link">tidytext</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkelab.org/ggtext/" class="external-link">ggtext</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidyverse/glue" class="external-link">glue</a></span><span class="op">)</span>

 <span class="va">df_epi</span> <span class="op">&lt;-</span> <span class="fu">mindthegap</span><span class="fu">::</span><span class="fu"><a href="../reference/pull_unaids.html">pull_unaids</a></span><span class="op">(</span>sheetname <span class="op">=</span> <span class="st">"HIV Estimates - Integer"</span>, pepfar_only <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  </code></pre></div>
<ul>
<li>To create the epidemic control curves, you will need 2 indicators from the <code>HIV Estimates - Integer</code> tab:
<ul>
<li><strong><code>New HIV Infections</code></strong></li>
<li><strong><code>AIDS Related Deaths</code></strong></li>
</ul>
</li>
</ul>
<p>Let’s first filter the data down to the 2 indicators that we need, and filter for all sexes and all ages.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"> <span class="co">#Filter down to the estimate and all ages, and the indicators you need</span>
  <span class="va">df_epi_pepfar</span> <span class="op">&lt;-</span> <span class="va">df_epi</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">stat</span> <span class="op">==</span> <span class="st">"est"</span>,
           <span class="va">age</span> <span class="op">==</span> <span class="st">"all"</span>,
           <span class="va">sex</span> <span class="op">==</span> <span class="st">"all"</span>,
           <span class="va">indicator</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AIDS Related Deaths"</span>, <span class="st">"New HIV Infections"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">country</span>, <span class="va">indicator</span>, <span class="va">value</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">country</span>, <span class="va">indicator</span>, <span class="va">year</span><span class="op">)</span> 
  
<span class="va">df_epi_pepfar</span></code></pre></div>
<ul>
<li>Let’s now perform some munging to easily identify some metrics that we care about for the PEPFAR definition of epidemic control.
<ul>
<li>
<strong>Declining deaths</strong>: use <code><a href="https://dplyr.tidyverse.org/reference/lead-lag.html" class="external-link">dplyr::lag()</a></code> function to create a <code>value = TRUE</code> if deaths are declining</li>
<li>
<strong>Infections below deaths</strong>: <code>TRUE</code> wherever infections &lt; deaths</li>
<li><strong>Ratio of infections / AIDS-related deaths</strong></li>
<li>
<strong>Epi_control</strong>: <code>TRUE</code> if declining deaths and infections below deaths are both true</li>
</ul>
</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R">  <span class="va">df_epi_pepfar</span> <span class="op">&lt;-</span> <span class="va">df_epi_pepfar</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">mutate</span><span class="op">(</span>indicator <span class="op">=</span> <span class="fu">word</span><span class="op">(</span><span class="va">indicator</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="va">tolower</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="co">#simplifies the indicator names</span>
    <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="st">"indicator"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="co">#pivots data wide into deaths and infections column</span>
    <span class="fu">group_by</span><span class="op">(</span><span class="va">country</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">mutate</span><span class="op">(</span>declining_deaths <span class="op">=</span> <span class="va">deaths</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">deaths</span>, order_by <span class="op">=</span> <span class="va">year</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="co">#create a value that if true indicates declining deaths</span>
    <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">mutate</span><span class="op">(</span>infections_below_deaths <span class="op">=</span> <span class="va">infections</span> <span class="op">&lt;</span> <span class="va">deaths</span>,
           ratio <span class="op">=</span> <span class="va">infections</span> <span class="op">/</span> <span class="va">deaths</span>,
           direction_streak <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sequence.html" class="external-link">sequence</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rle.html" class="external-link">rle</a></span><span class="op">(</span><span class="va">declining_deaths</span><span class="op">)</span><span class="op">$</span><span class="va">lengths</span><span class="op">)</span>,
           epi_control <span class="op">=</span> <span class="va">declining_deaths</span> <span class="op">==</span> <span class="cn">TRUE</span> <span class="op">&amp;</span> <span class="va">infections_below_deaths</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co">#epi control definition</span>

<span class="va">df_epi_pepfar</span></code></pre></div>
<p>Now that we have a workable dataframe, we can start to add color and style elements. Using <code><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse()</a></code> statements, we can add variables to indicate the colors of each indicator (drawing color inspiration from OHA’s <a href="(https://usaid-oha-si.github.io/styleguide/)" class="external-link">Data Visualization Style Guide</a>). We can also add change the value for AIDS-related deaths to create the dual-axis.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R">  <span class="co">#Add colors to indicators and flip axis</span>
  <span class="va">df_epi_pepfar</span> <span class="op">&lt;-</span> <span class="va">df_epi_pepfar</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">pivot_longer</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">infections</span>, <span class="va">deaths</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"indicator"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">arrange</span><span class="op">(</span><span class="va">country</span>, <span class="va">indicator</span>, <span class="va">year</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">mutate</span><span class="op">(</span>value_mod <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">indicator</span> <span class="op">==</span> <span class="st">"deaths"</span>, <span class="op">-</span><span class="va">value</span>, <span class="va">value</span><span class="op">)</span>,
           fill_color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">indicator</span> <span class="op">==</span> <span class="st">"deaths"</span>, <span class="va">old_rose</span>, <span class="va">denim</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Let’s filter our country down to Kenya now for a country-level epidemic control curve.</p>
<ul>
<li>We are also going to specify a couple more style elements to call on when we create our plot:
<ul>
<li>
<code>val_lab</code>: Adding a value label for the most recent year of data. We can use the <code><a href="https://scales.r-lib.org/reference/number.html" class="external-link">scales::number()</a></code> function to standardize the number format.</li>
<li>
<code>lab_pt</code>: Add a point at the most recent year’s value</li>
</ul>
</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#COUNTRY</span>
    <span class="va">df_viz_cntry</span> <span class="op">&lt;-</span> <span class="va">df_epi_pepfar</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">country</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"Kenya"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>val_lab <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op">~</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/number.html" class="external-link">number</a></span><span class="op">(</span><span class="va">value</span>, <span class="fl">1</span>, scale <span class="op">=</span> <span class="fl">1e-3</span>, suffix <span class="op">=</span> <span class="st">"k"</span><span class="op">)</span><span class="op">)</span>,
             lab_pt <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op">~</span> <span class="va">value_mod</span><span class="op">)</span>,
             country <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">country</span>, <span class="st">"Kenya"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="plotting-the-epidemic-control-curves">Plotting the epidemic control curves<a class="anchor" aria-label="anchor" href="#plotting-the-epidemic-control-curves"></a>
</h3>
<ul>
<li>Our dataframe is ready to go! Let’s get started with the viz. We’ll start by getting our framework down:
<ul>
<li>
<code>ggplot()</code>: to define our aesthetics (x = <code>year</code>, y = <code>value_mod</code>, group by the indicator, and add fill and color as <code>fill_color</code>)</li>
<li>
<code>geom_area()</code>: creates the area graph</li>
<li>
<code>geom_line()</code>: creates the line border on the area graph</li>
<li>
<code>geom_hline()</code>: adds a horizontal line at the x-axis</li>
</ul>
</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_viz_cntry</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
      <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">year</span>, <span class="va">value_mod</span>, group <span class="op">=</span> <span class="va">indicator</span>, fill <span class="op">=</span> <span class="va">fill_color</span>, color <span class="op">=</span> <span class="va">fill_color</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu">geom_area</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.25</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu">geom_hline</span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, color <span class="op">=</span> <span class="fu">glitr</span><span class="fu">::</span><span class="va">grey80k</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> 
      <span class="co"># geom_point(aes(y = lab_pt), na.rm = TRUE,</span>
      <span class="co">#            shape = 21, color = "white", size = 3) +</span>
      <span class="co"># geom_text(aes(label = val_lab), na.rm = TRUE,</span>
      <span class="co">#           hjust = -0.3,</span>
      <span class="co">#           family = "Source Sans Pro Light") +</span>
      <span class="co"># facet_wrap(~country, ncol = 2, scales = "free_y") +</span>
      <span class="co"># scale_y_continuous(labels = ~ scales::label_number_si()(abs(.))) +</span>
      <span class="co"># scale_x_continuous(breaks = seq(1990, 2025, 10)) +</span>
      <span class="co"># scale_fill_identity(aesthetics = c("fill", "color")) +</span>
      <span class="co"># labs(x = NULL, y = NULL) +</span>
      <span class="co"># coord_cartesian(expand = T, clip = "off") +</span>
      <span class="co"># glitr::si_style_ygrid() +</span>
      <span class="co"># theme(axis.text.y = ggtext::element_markdown(),</span>
      <span class="co">#       panel.spacing.x = unit(20, "pt"),</span>
      <span class="co">#       panel.spacing.y = unit(0, "pt"))</span></code></pre></div>
<ul>
<li>This is a good start. Let’s continue to add style elements, adjust the scales, and add annotations
<ul>
<li>
<code>geom_point()</code>: adds a point at <code>lab_pt</code> that we specified earlier</li>
<li>
<code>geom_text()</code>: adds the annotation <code>val_lab</code> that we specified earlier</li>
<li>scale_y_continuous(): cleans up the y-axis with <code><a href="https://scales.r-lib.org/reference/label_number_si.html" class="external-link">scales::label_number_si()</a></code>
</li>
<li>
<code>scale_x_continuous()</code>: breaks the x-axis year markings into 10 year increments from 1990 to 2025.</li>
</ul>
</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_viz_cntry</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
      <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">year</span>, <span class="va">value_mod</span>, group <span class="op">=</span> <span class="va">indicator</span>, fill <span class="op">=</span> <span class="va">fill_color</span>, color <span class="op">=</span> <span class="va">fill_color</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu">geom_area</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.25</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu">geom_hline</span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, color <span class="op">=</span> <span class="fu">glitr</span><span class="fu">::</span><span class="va">grey80k</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
       <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">lab_pt</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span>,
                  shape <span class="op">=</span> <span class="fl">21</span>, color <span class="op">=</span> <span class="st">"white"</span>, size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu">geom_text</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">val_lab</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span>,
                hjust <span class="op">=</span> <span class="op">-</span><span class="fl">0.3</span>,
                family <span class="op">=</span> <span class="st">"Source Sans Pro Light"</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu">scale_y_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="op">~</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_number_si.html" class="external-link">label_number_si</a></span><span class="op">(</span><span class="op">)</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu">scale_x_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1990</span>, <span class="fl">2025</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span> 
      <span class="co">#scale_fill_identity(aesthetics = c("fill", "color"))</span>
      <span class="co"># labs(x = NULL, y = NULL) +</span>
      <span class="co"># coord_cartesian(expand = T, clip = "off") +</span>
      <span class="co"># glitr::si_style_ygrid() +</span>
      <span class="co"># theme(axis.text.y = ggtext::element_markdown(),</span>
      <span class="co">#       panel.spacing.x = unit(20, "pt"),</span>
      <span class="co">#       panel.spacing.y = unit(0, "pt"))</span></code></pre></div>
<p>We’re almost there! Let’s tackle the issue of color - even though we specified the color of the indicators in our aesthetics earlier, it still doesn’t see to be registering our <code>fill_color.</code> To solve this issue, we have to use the function <code>scale_fill_identity()</code> to tell ggplot to use our pre-specified fill_color column as the color identity.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_viz_cntry</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
      <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">year</span>, <span class="va">value_mod</span>, group <span class="op">=</span> <span class="va">indicator</span>, fill <span class="op">=</span> <span class="va">fill_color</span>, color <span class="op">=</span> <span class="va">fill_color</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu">geom_area</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.25</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu">geom_hline</span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, color <span class="op">=</span> <span class="fu">glitr</span><span class="fu">::</span><span class="va">grey80k</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
       <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">lab_pt</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span>,
                  shape <span class="op">=</span> <span class="fl">21</span>, color <span class="op">=</span> <span class="st">"white"</span>, size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu">geom_text</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">val_lab</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span>,
                hjust <span class="op">=</span> <span class="op">-</span><span class="fl">0.3</span>,
                family <span class="op">=</span> <span class="st">"Source Sans Pro Light"</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu">scale_y_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="op">~</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_number_si.html" class="external-link">label_number_si</a></span><span class="op">(</span><span class="op">)</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu">scale_x_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1990</span>, <span class="fl">2025</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
      <span class="fu">scale_fill_identity</span><span class="op">(</span>aesthetics <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"fill"</span>, <span class="st">"color"</span><span class="op">)</span><span class="op">)</span>
      <span class="co"># labs(x = NULL, y = NULL) +</span>
      <span class="co"># coord_cartesian(expand = T, clip = "off") +</span>
      <span class="co"># glitr::si_style_ygrid() +</span>
      <span class="co"># theme(axis.text.y = ggtext::element_markdown(),</span>
      <span class="co">#       panel.spacing.x = unit(20, "pt"),</span>
      <span class="co">#       panel.spacing.y = unit(0, "pt"))</span></code></pre></div>
<ul>
<li>Much better - we’re almost there! Let’s finish off our plot with some themes and styles.
<ul>
<li>
<code>labs()</code>: By specifying x and y as <code>NULL</code>, we are removing the labels on the axis. Here is where you can add additional annotations such as titles, subtitles, captions, etc.</li>
<li>
<code>coord_cartesian()</code>: changing cartesian plot and clipping preferences</li>
<li>
<code>glitr::si_style_ygrid()</code>: uses standard SI style format from the <code>glitr</code> package</li>
<li>
<code>theme()</code>:</li>
</ul>
</li>
</ul>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_viz_cntry</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
      <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">year</span>, <span class="va">value_mod</span>, group <span class="op">=</span> <span class="va">indicator</span>, fill <span class="op">=</span> <span class="va">fill_color</span>, color <span class="op">=</span> <span class="va">fill_color</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu">geom_area</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.25</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu">geom_hline</span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, color <span class="op">=</span> <span class="fu">glitr</span><span class="fu">::</span><span class="va">grey80k</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
       <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">lab_pt</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span>,
                  shape <span class="op">=</span> <span class="fl">21</span>, color <span class="op">=</span> <span class="st">"white"</span>, size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu">geom_text</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">val_lab</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span>,
                hjust <span class="op">=</span> <span class="op">-</span><span class="fl">0.3</span>,
                family <span class="op">=</span> <span class="st">"Source Sans Pro Light"</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu">scale_y_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="op">~</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_number_si.html" class="external-link">label_number_si</a></span><span class="op">(</span><span class="op">)</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu">scale_x_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1990</span>, <span class="fl">2025</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
      <span class="fu">scale_fill_identity</span><span class="op">(</span>aesthetics <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"fill"</span>, <span class="st">"color"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">country</span>, ncol <span class="op">=</span> <span class="fl">2</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu">coord_cartesian</span><span class="op">(</span>expand <span class="op">=</span> <span class="cn">T</span>, clip <span class="op">=</span> <span class="st">"off"</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu">glitr</span><span class="fu">::</span><span class="fu">si_style_ygrid</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu">theme</span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu">ggtext</span><span class="fu">::</span><span class="fu">element_markdown</span><span class="op">(</span><span class="op">)</span>,
            panel.spacing.x <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">20</span>, <span class="st">"pt"</span><span class="op">)</span>,
            panel.spacing.y <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">0</span>, <span class="st">"pt"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Aaron Chafetz, Karishma Srikanth.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
